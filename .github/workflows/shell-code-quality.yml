name: Shell Code Quality

on:
  pull_request:
    paths:
    - '.docker/**.sh'
    - 'lib/dojo-src/rebuild-dojo.sh'
    - 'utils/**.sh'
  # Allow manual triggering
  workflow_dispatch:
  # Allow other workflows (e.g. Publish) to invoke this one.
  workflow_call:


env:
  fail-fast: true


permissions:
  contents: read


jobs:
  shellcheck:
    name: ShellCheck
    runs-on: ubuntu-latest

    steps:
    - name: Check out code
      uses: actions/checkout@v5

    - name: Run ShellCheck
      # TODO: Remove after addressing initial issues
      continue-on-error: true
      run: |
        docker run --rm koalaman/shellcheck:stable --version
        find .docker lib/dojo-src utils -type f -name '*.sh' -exec \
          docker run --rm -v "$PWD:/mnt" -w /mnt koalaman/shellcheck:stable --shell=busybox {} +
